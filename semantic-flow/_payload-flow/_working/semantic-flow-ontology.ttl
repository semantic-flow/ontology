@base <https://semantic-flow.github.io/ontology/semantic-flow/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix schema: <https://schema.org/> .
@prefix vann: <http://purl.org/vocab/vann/> .
@prefix sflo: <https://semantic-flow.github.io/ontology/semantic-flow/> .

<> a owl:Ontology ;
    dcterms:title "Semantic Flow Ontology" ;
    dcterms:description "The Semantic Flow ontology defines the classes and properties used for defining and describing semantic meshes." ;
    dcterms:creator <https://djradon.github.io/ns/djradon/> ;
    owl:versionInfo "1" ;
    owl:versionIRI <https://semantic-flow.github.io/ontology/semantic-flow/_payload-flow/_default/sflo.ttl> ;
    vann:preferredNamespacePrefix "sflo" ;
    vann:preferredNamespaceUri "https://semantic-flow.github.io/ontology/semantic-flow/" .

#################################################################
#    Resource Classes and Properties
#################################################################


<Resource/> a rdfs:Class ;
    rdfs:label "Resource" ;
    rdfs:comment "Abstract base class for all Semantic Flow resources. Provides fundamental identification and documentation affordances." .

# File-based resources (e.g., README.md, index.html, .jsonld distributions)
<FileResource/> a rdfs:Class ;
    rdfs:subClassOf <Resource/> ;
    rdfs:label "File Resource" ;
    rdfs:comment "A resource that locates and corresponds directly to a file." .

# Naming resources (folder-like, slash-terminated IRIs)
<NamingResource/> a rdfs:Class ;
    rdfs:subClassOf <Resource/> ;
    rdfs:label "Naming Resource" ;
    rdfs:comment "A resource that establishes a name, optionally denoting a non-file thing. Naming resources' IRIs end with a slash and may or may not have a referent." .

<hasResource/> a owl:ObjectProperty ;
    schema:domainIncludes <Resource/> ;
    schema:rangeIncludes <Resource/> ;
    rdfs:label "has resource" ;
    rdfs:comment "Abstract base property for associating resources." .

<AssetTree> a rdfs:Class ;
    rdfs:subClassOf sflo:Component, mesh:NamingResource/> ;
    rdfs:label "AssetTree" ;
    rdfs:comment "Asset trees contain collections of files and directories that are not MeshResources. Can be contained in any NamingResource." .


#################################################################
#    Node Classes and Properties
#################################################################

# Mesh Node Classes

<MeshNode/> a rdfs:Class ;
    rdfs:subClassOf <NamingResource/> ;
    rdfs:label "Mesh Node" ;
    rdfs:comment "Structural units that organize and contain other resources. Nodes form the structure of the mesh." .

<BareNode/> a rdfs:Class ;
    rdfs:subClassOf <MeshNode/> ;
    rdfs:label "Namespace" ;
    rdfs:comment "Bare nodes - containers for organizing other mesh nodes. Node identifiers refer to the nodes themselves as organizational units." .

<ReferenceNode/> a rdfs:Class ;
    rdfs:subClassOf <MeshNode/> ;
    rdfs:label "Reference" ;
    rdfs:comment "Nodes that refer to some external 'thing' or concept other than themselves." .

<PayloadNode/> a rdfs:Class ;
    rdfs:subClassOf <MeshNode/> ;
    rdfs:label "Data" ;
    rdfs:comment "Nodes that contain and refer to 'payload data' via a payload flows." .

# Mesh Node Properties

<hasComponent/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasResource/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <Component/> ;
    rdfs:label "has component" ;
    rdfs:comment "Associates nodes with their supporting components." .

<isHandleFor/> a owl:ObjectProperty ;
    owl:inverseOf <hasHandle/> ;
    rdfs:domain <HandleAsComponent/> ;
    rdfs:range <MeshNode/> ;
    rdfs:label "is handle for" ;
    rdfs:comment "Indicates that this handle component provides identification and routing for a specific node." .

<hasHandle/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasComponent/> ;
    owl:inverseOf <isHandleFor/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <HandleAsComponent/> ;
    rdfs:label "has handle" ;
    rdfs:comment "Associates a mesh node with its persistent handle component." .

<slug/> a owl:AnnotationProperty ;
    schema:domainIncludes <MeshNode/>, <Flow/> ;
    schema:rangeIncludes xsd:string ;
    rdfs:label "has slug" ;
    rdfs:comment "A concise, human-readable, kebab-case identifier for a node or a flow, suitable for use in filenames and URLs." .


#################################################################
#    Node Component Classes and Properties
#################################################################

<Component/> a rdfs:Class ;
    rdfs:subClassOf <Resource/> ;
    rdfs:label "Component" ;
    rdfs:comment "Terminal resources that provide specific mesh functionality and support nodes." .

<Handle/> a rdfs:Class ;
    rdfs:subClassOf <NamingResource/> ;
    rdfs:label "Handle" ;
    rdfs:comment "Conceptual handle that refers to a node 'as a node' (as opposed to the thing/concept referred to by the parent node). This is the abstract handle concept." .

<HandleAsComponent/> a rdfs:Class ;
    rdfs:subClassOf <Component/>, <Resource/> ;
    rdfs:label "Handle As Component" ;
    rdfs:comment "A handle considered as a mesh component in its own right, addressable via IRI and subject to mesh operations." .

# DocumentationResource Classes 

<DocumentationResource/> a rdfs:Class ;
    rdfs:subClassOf <FileResource/> ;
    rdfs:label "Documentation Resource" ;
    rdfs:comment "Documentation files that provide human-readable information about resources." .

<ResourcePage/> a rdfs:Class ;
    rdfs:subClassOf <DocumentationResource/> ;
    rdfs:label "Resource Page" ;
    rdfs:comment "Human-readable index.html pages that provide dereferenceability for NamingResources." .

<Changelog/> a rdfs:Class ;
    rdfs:subClassOf <DocumentationResource/> ;
    rdfs:label "Changelog" ;
    rdfs:comment "Changelog files that document version history and changes for resources." .

<Readme/> a rdfs:Class ;
    rdfs:subClassOf <DocumentationResource/> ;
    rdfs:label "Readme" ;
    rdfs:comment "Readme files that provide introductory documentation and usage information." .


# DocumentationResource Properties

<hasDocumentationResource/> a owl:ObjectProperty ;
    schema:domainIncludes <NamingResource/> ;
    schema:rangeIncludes <DocumentationResource/> ;
    rdfs:label "has DocumentationResource" ;
    rdfs:comment "Associates a resource with a documentation resource." .

<hasResourcePage/> a owl:ObjectProperty ;
    schema:domainIncludes <NamingResource/> ;
    schema:rangeIncludes <ResourcePage/> ;
    rdfs:label "has ResourcePage" ;
    rdfs:comment "Associates a NamingResource with its index.html resource page file." .

<hasReadme/> a owl:ObjectProperty ;
    schema:domainIncludes <NamingResource/> ;
    schema:rangeIncludes <Readme/> ;
    rdfs:label "has Readme" ;
    rdfs:comment "Associates a NamingResource with its README documentation file." .

<hasChangelog/> a owl:ObjectProperty ;
    schema:domainIncludes <NamingResource/> ;
    schema:rangeIncludes <Changelog/> ;
    rdfs:label "has Changelog" ;
    rdfs:comment "Associates a NamingResource with its changelog documentation file." .


# Flow Classes

<Flow/> a rdfs:Class ;
    rdfs:subClassOf dcat:DatasetSeries, <Resource/> ;
    rdfs:label "Flow" ;
    rdfs:comment "Abstract evolvable datasets for node metadata, reference data, payload data, and configuration. Flows are DatasetSeries that are realized through flow snapshots representing specific states or versions." .

<NodeMetadataFlow/> a rdfs:Class ;
    rdfs:subClassOf <Flow/> ;
    <slug/> "_node-metadata-flow" ;
    rdfs:label "Metadata Flow" ;
    rdfs:comment "Flow containing metadata about the mesh node itself." .

<ReferenceFlow/> a rdfs:Class ;
    rdfs:subClassOf <Flow/> ;
    <slug/> "_reference-flow" ;
    rdfs:label "Reference Flow" ;
    rdfs:comment "Flow containing reference data about the thing or concept referred to by the mesh node." .

<PayloadFlow/> a rdfs:Class ;
    rdfs:subClassOf <Flow/> ;
    <slug/> "_payload-flow" ;
    rdfs:label "Payload Flow" ;
    rdfs:comment "Flow containing the dataset payload associated with the mesh node." .

<NodeConfigFlow/> a rdfs:Class ;
    rdfs:subClassOf <Flow/> ;
    rdfs:label "Node Config Flow" ;
    rdfs:comment "Abstract flow for mesh node configuration data." .

<InheritableNodeConfigFlow/> a rdfs:Class ;
    rdfs:subClassOf <NodeConfigFlow/> ;
    <slug/> "_config-inheritable-flow" ;
    rdfs:label "Inheritable Node Config Flow" ;
    rdfs:comment "Node configuration flow whose settings can be inherited by child nodes." .

<OperationalNodeConfigFlow/> a rdfs:Class ;
    rdfs:subClassOf <NodeConfigFlow/> ;
    <slug/> "_config-operational-flow" ;
    rdfs:label "Operational Node Config Flow" ;
    rdfs:comment "Node configuration flow whose settings apply only to the specific node." .

# Flow Properties
    
<hasFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasComponent/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <Flow/> ;
    rdfs:label "has Flow" ;
    rdfs:comment "Links mesh nodes to their flows (metadata, reference, data, config)." .

<hasNodeMetadataFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasFlow/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <NodeMetadataFlow/> ;
    rdfs:label "has NodeMetadataFlow" ;
    rdfs:comment "Links mesh nodes to their metadata flow." .

<hasReferenceFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasFlow/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <ReferenceFlow/> ;
    rdfs:label "has ReferenceFlow" ;
    rdfs:comment "Links mesh nodes to their reference flow." .

<hasPayloadFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasFlow/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <PayloadFlow/> ;
    rdfs:label "has PayloadFlow" ;
    rdfs:comment "Links mesh nodes to their payload flow." .

<hasInheritableNodeConfigFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasFlow/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <InheritableNodeConfigFlow/> ;
    rdfs:label "has InheritableNodeConfigFlow" ;
    rdfs:comment "Links mesh nodes to their inheritable node config flow." .

<hasOperationalNodeConfigFlow/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasFlow/> ;
    rdfs:domain <MeshNode/> ;
    rdfs:range <OperationalNodeConfigFlow/> ;
    rdfs:label "has OperationalNodeConfigFlow" ;
    rdfs:comment "Links mesh nodes to their operational node config flow." .

#################################################################
#    Snapshot Classes and Properties
#################################################################

<Snapshot/> a owl:Class ;
    rdfs:subClassOf <NamingResource/>, dcat:Dataset ;
    rdfs:label "Snapshot" ;
    rdfs:comment "Snapshots represent distinct states of a node flow (dataset), and contain actual RDF data files (aka Distributions)." .

<VersionSnapshot/> a owl:Class ;
    rdfs:subClassOf <Snapshot/> ;
    rdfs:label "VersionSnapshot" ;
    rdfs:comment "Historical version snapshot of a node flow, representing a specific versioned snapshot." .

<DefaultSnapshot/> a owl:Class ;
    rdfs:subClassOf <Snapshot/> ;
    rdfs:label "DefaultSnapshot" ;
    rdfs:comment "The default snapshot of a node flow, representing the latest state." .

#################################################################
#    Object Properties
#################################################################

<hasSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf prov:specializationOf ;
    schema:domainIncludes <Flow/> ;
    schema:rangeIncludes <Snapshot/> ;
    rdfs:label "hasSnapshot" ;
    rdfs:comment "Associates a Flow with its snapshots. This property enables version management within flows and helps implement the prov: model" .

<hasDefaultSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasSnapshot/> ;
    rdfs:domain <Flow/> ;
    schema:rangeIncludes <DefaultSnapshot/> ;
    rdfs:label "hasDefaultSnapshot" ;
    rdfs:comment "Associates a Flow with its default snapshot." .

<hasWorkingSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasSnapshot/> ;
    rdfs:label "has working snapshot" ;
    rdfs:comment "Links to the working snapshot of this flow." ;
    rdfs:domain <Flow/> ;
    schema:rangeIncludes <DefaultSnapshot/> .

<hasVersionSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf <hasSnapshot/> ;
    schema:domainIncludes sflo:Flow ;
    schema:rangeIncludes <VersionSnapshot/> ;
    rdfs:label "hasVersionSnapshot" ;
    rdfs:comment "Associates a Flow with its version snapshots." .

<hasNextSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf dcat:nextVersion ;
    rdfs:label "has working snapshot" ;
    rdfs:comment "Links to the working version snapshot of this snapshot." ;
    schema:domainIncludes <VersionSnapshot/> ;
    schema:rangeIncludes <VersionSnapshot/> .

<hasPreviousSnapshot/> a owl:ObjectProperty ;
    rdfs:subPropertyOf dcat:previousVersion ;
    rdfs:label "has previous snapshot" ;
    rdfs:comment "Links to the previous version snapshot of this snapshot." ;
    schema:domainIncludes <VersionSnapshot/> ;
    schema:rangeIncludes <VersionSnapshot/> .

<versioningState/> a owl:DatatypeProperty ;
    rdfs:label "versioning state" ;
    rdfs:comment "The versioning state of a sflo: 'versioned', 'unversioned', or 'deversioned'." ;
    schema:domainIncludes sflo:Flow ;
    schema:rangeIncludes xsd:string .

<versionKey/> a owl:DatatypeProperty ;
    schema:domainIncludes sflo:Flow ;
    schema:rangeIncludes xsd:decimal ;
    rdfs:label "version key" ;
    rdfs:comment """
A sortable numeric identifier for a flow's snapshots. The value encodes the UTC date and time of creation (weave) in compact decimal form
(YYYYMMDD.HHMMSS or YYYYMMDD.HHMMSSmmm), enabling simple chronological (lexical AND numeric) comparison in SPARQL and across file-system hierarchies.
Used as the identifier for folder-named snapshots and as a lightweight temporal ordering key when full RDF provenance data is unavailable.
""" ;
    rdfs:seeAlso dcat:version , prov:generatedAtTime .

<hasOperationalConfigFlow/> a owl:ObjectProperty ;
    schema:domainIncludes sflo:Handle ;
    schema:rangeIncludes <OperationalNodeConfigFlow/> ;
    rdfs:label "opertaional config" ;
    rdfs:comment "Links mesh nodes to their operational config flow." .

<hasInheritableConfigFlow/> a owl:ObjectProperty ;
    schema:domainIncludes sflo:Handle ;
    schema:rangeIncludes <InheritableNodeConfigFlow/> ;
    rdfs:label "inheritable config" ;
    rdfs:comment "Links mesh nodes to their operational config flow." .

<hasMetadataFlow/> a owl:ObjectProperty ;
    schema:domainIncludes sflo:Handle ;
    schema:rangeIncludes <NodeMetadataFlow/> ;
    rdfs:label "metadata flow" ;
    rdfs:comment "Links mesh nodes to their metadata flow." .

<hasReferenceFlow/> a owl:ObjectProperty ;
    schema:domainIncludes sflo:Handle ;
    schema:rangeIncludes <Reference/> ;
    rdfs:label "reference flow" ;
    rdfs:comment "Links mesh nodes to their reference flow." .

<hasPayloadFlow/> a owl:ObjectProperty ;
    schema:domainIncludes sflo:Handle ;
    schema:rangeIncludes <Data/> ;
    rdfs:label "payload flow" ;
    rdfs:comment "Links mesh nodes to their data flow." .    


#################################################################
#    Disjointness Axioms 
#################################################################

# File vs Naming resources are disjoint
[ a owl:AllDisjointClasses ;
  owl:members ( <FileResource/> <NamingResource/> )
] .

# Node types are disjoint
[ a owl:AllDisjointClasses ;
  owl:members ( <BareNode/> <ReferenceNode/> <PayloadNode/> )
] .

# Component types are disjoint
[ a owl:AllDisjointClasses ;
  owl:members ( <HandleAsComponent/> <DocumentationResource/> )
] .

#################################################################
#    SHACL Constraints 
#################################################################
